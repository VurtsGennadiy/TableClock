# Настольные часы

## Функционал

Настольные часы с цифровым дисплеем на 4 символа, поочерёдно отображают время (часы:минуты в течении 10 сек), дату (день:месяц в течении 2 сек) и температуру окружающей среды (в течении 2 сек).
Яркость дисплея имеет 8 градаций, реализовано снижение яркости в ночное время (с 23 до 7 часов). Есть функция будильника. Время включения будильника устанавливается отдельно для
буднего (пн - пт) и выходного (сб - вс) дня. Имеется 4 различных мелодии будильника. Будильник играет мелодию 1 раз и отключается. Установка времени осуществляется через подключение к ПК по USB.

## Железо
* Центральное звено всей системы - плата микрокроконтроллера Arduino nano на чипе AtMega328P
* [Модуль часов реального времени DS1307](https://aliexpress.ru/item/32585872245.html?sku_id=12000021606776142&spm=a2g2w.productlist.search_results.0.44564aa6Bgo3Gt) интерфейс I2C.
* В качестве дисплея использован модуль дисплея [TM1637 4 - символьный 7 - сегментный](https://aliexpress.ru/item/1005001621808741.html?sku_id=12000016846561655&spm=a2g2w.productlist.search_results.1.56024aa6O2jVVB),
имеет двухпроводный последовательный интерфейс, подобный I2C. Подключен к пинам D4 - DIO, D5 - CLK.
* За измерение температуры отвечает Цифровой температурный датчик [DS18B20](https://aliexpress.ru/item/1005001621790730.html?sku_id=12000016846642752&spm=a2g2w.productlist.search_results.1.554f4aa6or2nkg), однопроводный интерфейс
OneWire, подключен на пин D6, с подтягивающим резистором 4,7 кОм.
* В качестве динамика используется пассивный пьезоилучатель (зумер) - без встроенного генератора. В качестве генератора сигнала выступает Arduino. Подключен на пин A0.
* На пин D2 подключена кнопка без фиксации. По удержанию кнопки запускается функция установки времени.
* Питание всей системы осуществляется через разъём mini USB на плате Arduino. В модуле часов реального времени установлена батарейка CR2032, таким образом при отключении питания время не сбивается.

## Софт
В папке с проектом находятся два .zip архива с библиотеками **DateTime** и **OneWire** - их обязательно нужно установить. Остальные библиотеки расположены локально и установки не требуют.
* Включение / отключение функции будильника осуществляется установкой константы const bool ENABLE_ALARM.
* Выбор мелодии будильника осуществляется установкой константы const int8_t ALARM_MELODY (0 - пираты, 1 - крэйзи фрог, 2 - марио, 3 - титаник).
* Установка времени будильника в будний день const uint8_t hourAlarmWeekday, const uint8_t minuteAlarmWeekday.
* Установка времени будильника в выходной день const uint8_t hourAlarmWeekend, const uint8_t minuteAlarmWeekend.
* Время установления ночного режима задаётся константами const uint8_t hourNight и const uint8_t hourDay.
* Установка текущего времени осуществляется следующим образом:
1. Подключить часы к ПК по USB.
2. Открыть Arduino IDE, выбрать соответствующий com - порт, запустить монитор порта.
3. Установить опцию *нет конца строки*.
4. Зажать кнопку на часах до появления диалога.
5. Следовать инструкциям в мониторе порта.

В планах расширить функционал кнопки. Установить на неё опцию включения / отключения будильника и сделать вывод соответствующих информационных сообщений на дисплей часов.

![Фото часов](/Photo/20230813_153710.jpg)

Автор кода мелодий B.Aswinth Raj, 15-06-2017, CircuitDigest.com

Автор проекта Вурц Геннадий, 2022 год. 

